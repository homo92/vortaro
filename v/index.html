<!DOCTYPE html>
<html manifest="./manifest.php">

<head>
<title>พจนานุกรมเอสเปรันโต</title>
<meta http-equiv="Content-Type" CONTENT="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width" />
<link rel="icon" href="./eoth.png" type="image/x-icon"/>
<link rel="shortcut icon" href="./eoth.png" type="image/x-icon"/>
<script type=text/javascript>
function call_ajax_text_post(url, parameters, callback)
{
 var req = false;
 try {
  req = new XMLHttpRequest();
 } catch(e) {
  try {
   req = new ActiveXObject("Msxml2.XMLHTTP");
  } catch(e) {
   try {
    req = new ActiveXObject("Microsoft.XMLHTTP");
   } catch(e) {
    req = false;
   }
  }
 }

 if (! req) { return; }

 req.onreadystatechange = function() {
  if (req.readyState == 4 && req.status == 200) {
   callback(req.responseText);
  }
 };

 req.open("POST", encodeURI(url), true);
 req.setRequestHeader("Content-type", "application/x-www-form-urlencoded; charset='UTF-8'");
 req.setRequestHeader('Ajax', 'true');

 req.send(parameters);
}

function call_ajax_text_get(url, parameters, callback)
{
 var req = false;
 try {
  req = new XMLHttpRequest();
 } catch(e) {
  try {
   req = new ActiveXObject("Msxml2.XMLHTTP");
  } catch(e) {
   try {
    req = new ActiveXObject("Microsoft.XMLHTTP");
   } catch(e) {
    req = false;
   }
  }
 }

 if (! req) { return; }

 req.onreadystatechange = function() {
  if (req.readyState == 4 && req.status == 200) {
   callback(req.responseText);
  }
 };

 req.open("GET", encodeURI(url), true);
 req.setRequestHeader("Content-type", "application/x-www-form-urlencoded; charset='UTF-8'");
 req.setRequestHeader('Ajax', 'true');

 req.send(parameters);
}
</script>

<style>.body {
 orient: portrait;
}
.tdTitle { width:50px; }
.tb {
 width:100%;
 virtical-align:middle;
 border-collapse:collapse;
 font-family:Helvetica;
 text-shadow:#000000 1px 1px 1px;
 font-weight:bold;
 font-size:20px; color:#FFFFFF;
 background: #00B000;
}
.tbC { text-align: center; height: 42px; font-size:20pt}
.frm {
 width:100%;padding:0px;spacing:0px;background:#FFFFFF;
 font-family:Tohama;font-weight:bold;font-size:12pt;
}
.klarigo {align:center;}
.input {width:100%;border: 1px solid #999999;font-size:20pt;}
</style>

<script type="text/javascript">

function isEmpty(value) {
  if (value == "" || value == null || value == undefined || ( value != null && typeof value == "object" && !Object.keys(value).length ) ) {
    return true;
  } else {
    return false; 
  } 
}

function E(e) { return document.getElementById(e); }

function cxapelo(v)
{
  if (v.length > 100) { return v.subtring(0,100); }
  v = v.replace("cx","ĉ").replace("gx","ĝ").replace("hx","ĥ");
  v = v.replace("jx","ĵ").replace("sx","ŝ").replace("ux","ŭ");
  v = v.replace("Cx","Ĉ").replace("Gx","Ĝ").replace("Hx","Ĥ");
  v = v.replace("Jx","Ĵ").replace("Sx","Ŝ").replace("Ux","Ŭ");
  v = v.replace("ch","ĉ").replace("gh","ĝ").replace("hh","ĥ");
  v = v.replace("jh","ĵ").replace("sh","ŝ").replace("uh","ŭ");
  v = v.replace("Ch","Ĉ").replace("Gh","Ĝ").replace("Hh","Ĥ");
  v = v.replace("Jh","Ĵ").replace("Sh","Ŝ").replace("Uh","Ŭ");
  v = v.replace("c^","ĉ").replace("g^","ĝ").replace("h^","ĥ");
  v = v.replace("j^","ĵ").replace("s^","ŝ").replace("u^","ŭ");
  v = v.replace("C^","Ĉ").replace("G^","Ĝ").replace("H^","Ĥ");
  v = v.replace("J^","Ĵ").replace("S^","Ŝ").replace("U^","Ŭ");
  v = v.replace("au","aŭ").replace("eu","eŭ").replace("Au","Aŭ").replace("Eu","Eŭ");
  v = v.replace("ŭx","ŭ").replace("Ŭx","Ŭ").replace("w","ŭ").replace("W","Ŭ");
  return v;
}

function klaku_vorto(v)
{
  if (v == "") return;

  // 1
  var dic_json = localStorage['T_JSON'];
  if (! isEmpty(dic_json)) {
    dic = eval(dic_json);
  } else {
     alert("ยังไม่ได้ดาวน์โหลดข้อมูล โปรดดาวน์โหลดข้อมูลขณะเชื่อมต่ออินเตอร์เน็ตอยู่");
     return;
  }

  E("rezulto").innerHTML = "<br>กำลังค้นหา...";

  var result_linio = search(dic, v);
  if (result_linio.length == 0) {
    v = v.toLowerCase();
    result_linio = search(dic, v);
    if (result_linio.length == 0) {
        E("rezulto").innerHTML = "<br><br>ไม่พบคำศัพท์จ้า...";
        return;
    }
  }

  var result = highlight(result_linio, v);

  var str = "";
  for (var i = 0; i < result.length; i++) {
      str += result[i] + "\n";
  }

  E("rezulto").innerHTML = str;
}

function chapeligo()
{
  var X = "ĉĝĥĵŝŭĈĜĤĴŜŬ";
  var v = E("vorto").value;
  if (v.length == 0) {
  } else if (v.charCodeAt(0) < 127 || X.indexOf(v.substring(0, 1), 0) >= 0) {
    v = cxapelo(E("vorto").value);
   E("vorto").value = v;
  }
}

var dic = null;

function highlight(linio, vorto)
{
  var new_linio = new Array();

  var suffix = vorto.substring(vorto.length-1, vorto.length);
  if (vorto.length > 2 && "aeiou-/".indexOf(suffix) >= 0) {
    vorto = vorto.substring(0, vorto.length-1);
  }

  for (var i = 0; i < linio.length; i++) {
    var x = new_linio.length;
    new_linio[x] = linio[i];
    new_linio[x] = new_linio[x].split(vorto).join("<mark>"+vorto+"</mark>");
    new_linio[x] = "<b>" + new_linio[x].replace("\t", "</b>&nbsp;&nbsp;") + "<hr size=1>";
//สกรรม 
    if (new_linio[x].indexOf("(tr)") >= 0) {
      new_linio[x] = new_linio[x].replace("(tr)", "<B><i><font color=green size=-1>(tr)</font></i></B>");
    }
//อกรรม
    if (new_linio[x].indexOf("(ntr)") >= 0) {
      new_linio[x] = new_linio[x].replace("(ntr)", "<B><i><font color=green size=-1>(ntr)</font></i></B>");
    }
//สกรรมอกรรม
    if (new_linio[x].indexOf("(x)") >= 0) {
      new_linio[x] = new_linio[x].replace("(x)", "<B><i><font color=green size=-1>(x)</font></i></B>");
    }
//อุปมา
    if (new_linio[x].indexOf("(f)") >= 0) {
      new_linio[x] = new_linio[x].replace("(f)", "<B><i><font color=purple size=-1>(f)</font></i></B>");
    }
//
	if (new_linio[x].indexOf("(pre)") >= 0) {
      new_linio[x] = new_linio[x].replace("(pre)", "<B><i><font color=green size=-1>(pre)</font></i></B>");
    }
	if (new_linio[x].indexOf("(kon)") >= 0) {
      new_linio[x] = new_linio[x].replace("(kon)", "<B><i><font color=green size=-1>(kon)</font></i></B>");
    }
	if (new_linio[x].indexOf("(pro)") >= 0) {
      new_linio[x] = new_linio[x].replace("(pro)", "<B><i><font color=green size=-1>(pro)</font></i></B>");
    }
	if (new_linio[x].indexOf("(adv)") >= 0) {
      new_linio[x] = new_linio[x].replace("(adv)", "<B><i><font color=green size=-1>(adv)</font></i></B>");
    }
	if (new_linio[x].indexOf("(adj)") >= 0) {
      new_linio[x] = new_linio[x].replace("(adj)", "<B><i><font color=green size=-1>(adj)</font></i></B>");
    }
	if (new_linio[x].indexOf("(suf)") >= 0) {
      new_linio[x] = new_linio[x].replace("(suf)", "<B><i><font color=green size=-1>(suf)</font></i></B>");
    }
	if (new_linio[x].indexOf("(prep)") >= 0) {
      new_linio[x] = new_linio[x].replace("(prep)", "<B><i><font color=green size=-1>(prep)</font></i></B>");
    }
	if (new_linio[x].indexOf("(int)") >= 0) {
      new_linio[x] = new_linio[x].replace("(int)", "<B><i><font color=green size=-1>(int)</font></i></B>");
    }
	if (new_linio[x].indexOf("(fin)") >= 0) {
      new_linio[x] = new_linio[x].replace("(fin)", "<B><i><font color=green size=-1>(fin)</font></i></B>");
    }
	if (new_linio[x].indexOf("(kon)") >= 0) {
      new_linio[x] = new_linio[x].replace("(kon)", "<B><i><font color=green size=-1>(kon)</font></i></B>");
    }  
  }

  return new_linio;
}

function is_separator(c)
{
    if (c == ' ' || c == ',' || c == '.' || c == '[' ||
        c == ']' || c == ')' || c == '(' || c == '<' ||
        c == '>' || c == '-' || c == '=')
    {
        return 1;
    }

    return 0;
}

function score(word, entry)
{
    var score = 0;

    var suffix = word.substring(word.length-1, word.length);
    if (word.length > 2 && "aeiou-/".indexOf(suffix) >= 0) {
        word = word.substring(0, word.length-1);
    }

    var idx = entry.indexOf(word);
    if (idx == 0) {
        score += 30;
    }

    if (idx > 0 && is_separator(entry.charAt(idx-1))) {
        score += 20;
    }

    if (idx+word.length+1 < entry.length) {
        if (is_separator(entry.charAt(idx+word.length))) {
            if (idx == 0) {
                score += 50;
            } else {
                score += 3;
            }
        }
    }

    var splitted = entry.split(word);
    score += splitted.length;

    score = score+10000;

    return "{" + score + "}" + entry;
}

function search(dic, word)
{
    var result = new Array();
    var found = new Object;

    if (word.length < 2) {
        return result;
    }

    for (var i = 0; i < dic.length; i++) {
        if (word.length == 1) {
            if (dic[i].indexOf(word) == 0) {
                result[result.length] = score(word, dic[i]);
                found[i] = 1;
            }
        } else {
            if (dic[i].indexOf(word) >= 0) {
                result[result.length] = score(word, dic[i]);
                found[i] = 1;
            }
        }
    }

    var suffix = word.substring(word.length-1, word.length);
    if (word.length > 2 && "aeiou-/".indexOf(suffix) >= 0) {
        var word2 = word.substring(0, word.length-1);
        for (var i = 0; i < dic.length; i++) {
            if (! (i in found)) {
                if (dic[i].indexOf(word2) >= 0) {
                    result[result.length] = score(word, dic[i]);
                }
            }
        }
    }

    result.sort();
    result.reverse();

    for (var i = 0; i < result.length; i++) {
        result[i] = result[i].substring(7);
    }

    return result;
}

var load_status = "INIT";


window.onload = function()
{
  var dic_json = localStorage['T_JSON'];
  if (isEmpty(dic_json)) {
    E("Reset").disabled = true;
  }

  if (! isEmpty(dic_json)) {
    // alert("(A)length=" + dic_json.length + ", dic_json=" + dic_json);
    try {
      dic = eval(dic_json);
    } catch (e) {
      alert("-ERROR " + e + " (00A)");
      localStorage['T_JSON'] = '';
      load_status = "INIT";
      E("load").value = "ดาวน์โหลดข้อมูลขณะเชื่อมต่ออินเตอร์เน็ต";
      return;
    }
    // E("load").style.visibility = "hidden";
    E("load").value = "ดาวน์โหลดข้อมูลเรียบร้อย";
    E("load").disabled = true;
    load_status = "DONE";
    E("Reset").disabled = false;
  }

  E("vorto").onkeyup = function(e) {
    chapeligo();
    var code = '0';
    if (window.event) code = window.event.keyCode;
    else if (e) code = e.which;
    if (code == 13) {
      klaku_vorto(E("vorto").value);
    }
  };

  E("vorto").onclick = function() {
    E("vorto").select();
  };

  E("Serchu").onclick = function() {
    chapeligo();
    klaku_vorto(E("vorto").value);
  };

  E("Reset").onclick = function() {
    localStorage['T_JSON'] = ''
    load_status = 'INIT';
    E("load").value = "ดาวน์โหลดข้อมูลขณะเชื่อมต่ออินเตอร์เน็ต";
    E("Reset").disabled = true;
    E("load").disabled = false;
  };

  E("load").onclick = function() {
    if (load_status == "PROGRESS") {
      alert("กำลังดาวน์โหลด...");
      return;
    }

    if (load_status == "DONE") {
      return;
    }

    // 3
    var dic_json = localStorage['T_JSON'];
    if (! isEmpty(dic_json)) {
      try {
        dic = eval(dic_json);
      } catch (e) {
        alert("(b) " + e);
        localStorage['T_JSON'] = '';
        load_status = 'INIT';
        return;
      }
      E("load").value = "ดาวน์โหลข้อมูลเรียบร้อย";
      E("load").disabled = true;
      load_status = "DONE";
      E("Reset").disabled = false;
      return;
    }


    E("load").value = "กำลังดาวน์โหลด...";
    load_status = "PROGRESS";

    call_ajax_text_post("./dic.json.php", "time=" + new Date(),
      function(r) {

        var bytelike= unescape(encodeURIComponent(r));
        r = decodeURIComponent(escape(bytelike));

        localStorage['T_JSON'] = r;
        E("load").value = "ดาวน์โหลดข้อมูลเรียบร้อย";
        E("load").disabled = true;
        load_status = "DONE";
        E("Reset").disabled = false;
        try {
            dic = eval(localStorage['T_JSON']);
        } catch (e) {
            alert("(c) " + e);
            localStorage['T_JSON'] = '';
            load_status = 'INIT';
            E("load").value = "ดาวน์โหลดข้อมูลขณะเชื่อมต่ออินเตอร์เน็ต";
            E("Reset").disabled = true;
            return;
        }
      }
    );
  };
}
</script>
</head>

<body style="margin:0; padding:0">

<table class=tb>
 <tr><td class=tbC><b>พจนานุกรมเอสเปรันโต</b></td></tr>
</table>

<table class=frm>
 <tr>
  <td>
   <input type=text autocapitalize=off id=vorto class=input autocomplete=off>
  <td id=Serchu></td>
 </tr>
</table>

<span id="rezulto" class=klarigo style="font-size:14pt">
  ยินดีต้อนรับสู่พจนานุกรม เอสเปรันโต-ไทย ออนไลน์<br>
  <br>
  สามารถใช้พจนานุกรมออฟไลน์ได้เมื่อ
  <br>
  <input type=button id="load" value="ดาวน์โหลดข้อมูลขณะเชื่อมต่ออินเตอร์เน็ต" style="font-size:14pt">
<br>

  <br>
  ปรับปรุงข้อมูลเมื่อ 26 กันยายน 2561
  <br><br>
  <input type=button id="Reset" style="font-size:14pt;" value="ลบข้อมูลออก">
  <br>
  <br>

</span>


    <p>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="สัญญาอนุญาตของครีเอทีฟคอมมอนส์" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">พจนานุกรมเอสเปรันโต</span> โดย <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">วรุฒ บุญประเสริฐ</span> อนุญาตให้ใช้ได้ตาม <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">สัญญาอนุญาตของครีเอทีฟคอมมอนส์แบบ แสดงที่มา-อนุญาตแบบเดียวกัน 4.0 International</a>.<br />อยู่บนพื้นฐานของงานที่ <a xmlns:dct="http://purl.org/dc/terms/" href="vortaro.tk" rel="dct:source">vortaro.tk</a>.

</body>
</html>

